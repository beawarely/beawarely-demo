<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <meta name="robots" content="noindex, nofollow"/>
  <title>WorkVerify ‚Äì BeAwarely</title>
  <link rel="stylesheet" href="css/style.css"/>

    <style>
    /* --- Design tokens (dark navy by default, light = cool grey/blue) --- */
    :root{ --safe-top: env(safe-area-inset-top, 0px); }

    /* DARK (default) */
    body{
      --bg: #0B1220;             /* deep navy */
      --bg-elev: #0E1730;        /* slightly lighter */
      --card: #111B34;           /* panels/cards */
      --text: #E6ECF7;           /* primary text */
      --muted: #A9B7D9;          /* secondary text */
      --border: rgba(230,236,247,0.10);
      --accent: #3A63FF;         /* primary brand accent */
      --accent-2: #7EA0FF;       /* lighter for gradients */
      --pill: rgba(255,255,255,.08);
      --pill-hover: rgba(255,255,255,.14);
      --input-bg: rgba(255,255,255,.02);
      --shadow: 0 10px 24px rgba(12,20,40,.45);

      /* AI dock (DARK): deep greens */
      --ai-bg: #0d1f14;
      --ai-bg-2:#12361f;
      --ai-border: rgba(88,196,140,.25);
      --ai-text:#DFF7EA;
      --ai-muted:#9DD7B8;

      margin:0; font-family:'Segoe UI', system-ui, Arial, sans-serif;
      background: var(--bg); color: var(--text);
    }

    /* LIGHT */
    body.light-mode{
      --bg: #F4F7FB;             /* soft paper */
      --bg-elev: #ECF2FA;        /* section background */
      --card: #FFFFFF;           /* cards */
      --text: #0E1730;           /* ink */
      --muted: #5A6B89;
      --border: rgba(14,23,48,0.12);
      --accent: #2F54EB;
      --accent-2: #69A1FF;
      --pill: rgba(14,23,48,.06);
      --pill-hover: rgba(14,23,48,.10);
      --input-bg: rgba(14,23,48,.025);
      --shadow: 0 10px 22px rgba(18,30,60,.10);

      /* AI dock (LIGHT): soft grey-greens */
      --ai-bg:#ECF5EF;
      --ai-bg-2:#E3F0E8;
      --ai-border: rgba(29,105,76,.18);
      --ai-text:#103322;
      --ai-muted:#3a6a52;

      color: var(--text);
      background: linear-gradient(0deg, var(--bg), var(--bg));
    }

    /* Optional helper if you want to target explicitly */
    body.dark-mode{ background: var(--bg); }

    /* Topbar */
    #topbar{
      position:fixed; top:calc(14px + var(--safe-top)); left:20px; right:20px; z-index:10000;
      display:flex; justify-content:space-between; align-items:center; pointer-events:none;
    }
    #topbar .grp{ display:flex; gap:12px; align-items:center; pointer-events:auto; }
    .pill{
      background: var(--pill); color: inherit; font-weight:700; text-decoration:none;
      padding:6px 14px; border-radius:12px; border:1px solid var(--border);
      display:inline-flex; align-items:center; gap:8px; cursor:pointer;
      backdrop-filter: saturate(160%) blur(4px);
      transition: background .2s ease, transform .15s ease, border-color .2s ease;
    }
    .pill:hover{ background: var(--pill-hover); transform: translateY(-1px); }

    header{ text-align:center; padding: calc(120px + var(--safe-top)) 16px 12px; }
    header h1{ font-family:'Sriracha', cursive; font-size:56px; margin:0 0 8px; letter-spacing:.3px; }
    header p.sub{ color: var(--muted); margin:0; }

    main{ max-width:1100px; margin:0 auto; padding:24px 16px 60px; display:grid; gap:16px; }

    .panel{
      background: linear-gradient(180deg, var(--card), var(--card));
      border:1px solid var(--border);
      border-radius:16px; padding:16px;
      box-shadow: var(--shadow);
    }

    .panel h2{ margin:0 0 8px; font-size:20px; letter-spacing:.2px; }
    .muted{ color: var(--muted); }

    .actions{ display:flex; gap:8px; justify-content:flex-end; }
    .btn{
      border:none; padding:10px 14px; border-radius:10px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color:#fff; font-weight:800; cursor:pointer;
      transition: transform .12s ease, filter .2s ease, box-shadow .2s ease;
      box-shadow: 0 6px 16px rgba(48,92,255,.35);
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.05); }
    .btn:active{ transform: translateY(0); }

    .btn.secondary{
      background: transparent; color: inherit;
      border:1px solid var(--border);
      box-shadow: none;
    }

    textarea, input[type="text"]{
      width:100%; box-sizing:border-box; padding:10px 12px; border-radius:10px;
      border:1px solid var(--border); background: var(--input-bg); color:inherit; outline:none;
      transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;
    }
    textarea::placeholder, input::placeholder{ color: color-mix(in oklab, var(--muted) 65%, transparent); }
    textarea:focus, input[type="text"]:focus{
      border-color: color-mix(in oklab, var(--accent) 70%, white 30%);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent) 22%, transparent);
      background: color-mix(in oklab, var(--input-bg) 70%, white 30%);
    }

    .grid{ display:grid; grid-template-columns:repeat(2, minmax(260px,1fr)); gap:16px; }
    @media (max-width:900px){ .grid{ grid-template-columns:1fr; } }

    .badge{
      font-size:12px; padding:4px 8px; border-radius:999px;
      background: color-mix(in oklab, var(--accent) 16%, transparent);
      border:1px solid var(--border); color: inherit; display:inline-block;
    }
      /* Smooth theme transitions (1) */
    @media (prefers-reduced-motion: no-preference){
      body, .panel, .pill, .btn,
      input[type="text"], textarea, header, #topbar{
        transition:
          background-color .25s ease,
          color .25s ease,
          border-color .25s ease,
          box-shadow .25s ease,
          filter .25s ease;
      }
      /* shorten & synchronize transitions podczas prze≈ÇƒÖczania trybu */
      body.theme-anim *{ transition-duration:.25s !important; }
    }

    /* Enhanced header title (3) */
    header h1{
      font-family:'Sriracha', cursive; font-size:56px; margin:0 0 8px; letter-spacing:.3px;
      background: linear-gradient(90deg,
        color-mix(in oklab, var(--text) 85%, var(--accent) 15%),
        color-mix(in oklab, var(--accent) 60%, var(--text) 40%));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 2px 12px color-mix(in oklab, var(--accent) 22%, transparent);
    }
  /* Recent list */
    .recent-list{ display:grid; grid-template-columns:1fr; gap:10px; }
    .recent-card{
      padding:10px 12px; border:1px solid var(--border); border-radius:12px;
      background: color-mix(in oklab, var(--card) 92%, transparent);
    }
    .recent-meta{ display:flex; gap:8px; align-items:center; font-size:12px; color:var(--muted); margin-bottom:6px; }
    .recent-content{ margin:0; color:var(--text); opacity:.95; }

  </style>
<style>
  /* --- Draft toolbar & AI dock --- */
  .toolbar{ display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-end; margin-top:10px; }
  .ai-dock{
    position:fixed; right:18px; bottom:18px; width:min(360px, 92vw);
    background: linear-gradient(180deg, var(--ai-bg), var(--ai-bg-2));
    border:1px solid var(--ai-border); border-radius:14px; padding:12px;
    box-shadow: var(--shadow); z-index: 10001; color: var(--ai-text);
  }
  .ai-dock .muted, .ai-dock small{ color: var(--ai-muted); }
  .ai-dock textarea{ color: var(--ai-text); }
  .ai-dock.collapsed textarea, .ai-dock.collapsed .actions{ display:none; }
  .ai-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px; }
  .ai-toggle{ padding:4px 10px; }
  .ai-dock .btn{
    background: linear-gradient(135deg, #2FA36B, #70D39A);
    box-shadow: 0 6px 16px rgba(63,173,118,.35);
  }
  .ai-dock .btn.secondary{
    background: transparent;
    color: var(--ai-text);
    border:1px solid var(--ai-border);
  }
  #aiInput{ width:100%; box-sizing:border-box; margin:8px 0; background: rgba(255,255,255,.03); border:1px solid var(--ai-border); }

</style>


  <script>
    // light/dark toggle (sp√≥jne z innymi)
    document.addEventListener('DOMContentLoaded', ()=>{
  // Default: respect saved choice; if none, follow system preference
  const saved = localStorage.getItem('mode');
  const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
  const isLight = saved ? (saved === 'light') : prefersLight;

  document.body.classList.toggle('light-mode', isLight);
  document.body.classList.toggle('dark-mode', !isLight);
});
    function toggleLightDarkMode(){
  // Smooth theme switch (1) ‚Äì dodaj kr√≥tkƒÖ klasƒô animujƒÖcƒÖ
  document.body.classList.add('theme-anim');

  const isLight = document.body.classList.toggle('light-mode');
  document.body.classList.toggle('dark-mode', !isLight);
  localStorage.setItem('mode', isLight ? 'light' : 'dark');

  // usu≈Ñ klasƒô po animacji
  setTimeout(()=> document.body.classList.remove('theme-anim'), 280);
}

    /* wrapper ‚Äì prawdziwa implementacja w module poni≈ºej */
    function submitExperience(){
      if (window._submitExperienceImpl) return window._submitExperienceImpl();
      alert('Loading‚Ä¶');
    }
  </script>
</head>
<body>
  <!-- Topbar -->
  <div id="topbar">
    <div class="grp">
      <a href="index.html" class="pill">‚Üê Back</a>
    </div>
    <div class="grp">
      <button class="pill" onclick="toggleLightDarkMode()">üåì</button>
      <a href="profile.html" class="pill">Your Profile</a>
    </div>
  </div>

  <header>
    <h1>WorkVerify</h1>
    <p class="sub">Balanced employee‚Äìemployer verification. Real experiences, fair checks, clear signals.</p>
  </header>

  <main>
    <!-- Intro / scope -->
    <section class="panel">
      <h2>What this tool does</h2>
      <p class="muted">
        Collects first-hand experiences from both employees and employers, then uses AI to detect red/green flags,
        verify claims, and surface balanced insights. (Early prototype.)
      </p>
      <div class="badge">Prototype</div>
    </section>

    <!-- Quick submit (placeholder) -->
    <section class="panel">
      <h2>Share an experience (early)</h2>
      <div class="grid">
        <div>
          <label class="muted">Company (optional)</label>
          <input id="companyName" type="text" placeholder="e.g., ACME Sp. z o.o."/>
        </div>
        <div>
          <label class="muted">Role (optional)</label>
          <input id="roleName" type="text" placeholder="e.g., Warehouse Worker / HR Manager"/>
        </div>
      </div>
      <div style="margin-top:10px;">
        <label class="muted">Experience</label>
        <textarea id="expText" rows="5" placeholder="Describe the situation. Keep it factual; avoid personal data."></textarea>
      </div>
      <div class="toolbar">
        <button id="saveDraftBtn" class="btn secondary" type="button">Save draft</button>
        <button id="loadDraftBtn" class="btn secondary" type="button">Load draft</button>
        <button id="clearDraftBtn" class="btn secondary" type="button">Clear</button>
        <button id="submitBtn" class="btn" type="button" onclick="submitExperience()">Publish</button>
      </div>
    </section>

    <!-- Recent (approved) -->
    <section class="panel">
      <h2>Recent experiences (approved)</h2>
      <div id="recentList" class="recent-list"></div>
    </section>

    <!-- Roadmap / coming next -->
    <section class="panel">
      <h2>Coming next</h2>
      <ul class="muted" style="margin:8px 0 0 18px;">
        <li>AI roles: evidence checker, bias detector, legal/ethics lens.</li>
        <li>Company dossiers: timelines, signals, and patterns.</li>
        <li>Balanced inputs: both employees and employers.</li>
        <li>Privacy & moderation pipeline.</li>
      </ul>
    </section>
    </main>

  <!-- Mini AI assistant dock (context-aware) -->
  <div id="aiDock" class="ai-dock collapsed">
    <div class="ai-head">
      <strong>AI Assist ‚Äî WorkVerify</strong>
      <button class="pill ai-toggle" type="button" onclick="document.getElementById('aiDock').classList.toggle('collapsed')">Toggle</button>
    </div>
    <textarea id="aiInput" rows="3" placeholder="Ask about tone, legality, or red/green flags‚Ä¶"></textarea>
    <div class="actions">
      <button id="aiUseDraftBtn" class="btn secondary" type="button">Use my draft</button>
      <button id="aiOpenChatBtn" class="btn" type="button">Open in AI Chat ‚Üí</button>
    </div>
  </div>

<!-- Supabase + funkcjonalno≈õƒá strony -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // KONFIGURACJA: podmie≈Ñ na swoje warto≈õci lub zdefiniuj globalnie window.__SUPABASE_URL / __SUPABASE_ANON_KEY
        const SUPABASE_URL = window.__SUPABASE_URL || "https://xzwpqyomqjzmiqsszwkg.supabase.co";
    const SUPABASE_ANON_KEY = window.__SUPABASE_ANON_KEY || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh6d3BxeW9tcWp6bWlxc3N6d2tnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0MjIxMTYsImV4cCI6MjA2OTk5ODExNn0.QbjDO1xifFkDuIAZZ9WHfGomgxwhanP9BQtgMrFqDgg";

    const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    window.sb = sb;

        const $ = (sel)=> document.querySelector(sel);
    const companyEl = $('#companyName');
    const roleEl = $('#roleName');
    const textEl = $('#expText');
    const submitBtn = $('#submitBtn');
    const recentList = $('#recentList');

    // Draft & AI controls
    const saveDraftBtn = $('#saveDraftBtn');
    const loadDraftBtn = $('#loadDraftBtn');
    const clearDraftBtn = $('#clearDraftBtn');
    const aiInputEl = $('#aiInput');
    const aiUseDraftBtn = $('#aiUseDraftBtn');
    const aiOpenChatBtn = $('#aiOpenChatBtn');

    // helper: per-user draft key
    let _lastUserId = 'anon';
    const draftKey = () => `wv_draft_${_lastUserId}`;


        function escapeHTML(s){
      return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
    }

    /* ------- Drafts (local-only) ------- */
    function readDraft(){
      try{ return JSON.parse(localStorage.getItem(draftKey())||'null'); }catch(e){ return null; }
    }
    function writeDraft(obj){
      localStorage.setItem(draftKey(), JSON.stringify({ ...obj, ts: Date.now() }));
    }
    function loadDraftIntoForm(){
      const d = readDraft();
      if(!d){ alert('No saved draft.'); return; }
      companyEl.value = d.company || '';
      roleEl.value = d.role || '';
      textEl.value = d.content || '';
      alert('Draft loaded.');
    }
    function saveDraftFromForm(){
      const payload = {
        company: (companyEl.value||'').trim(),
        role: (roleEl.value||'').trim(),
        content: (textEl.value||'').trim()
      };
      if(!payload.company && !payload.role && !payload.content){
        alert('Draft is empty. Type something first.'); return;
      }
      writeDraft(payload);
      alert('Draft saved locally.');
    }

    /* ------- Mini AI ------- */
    function buildAIContext(){
      const company = (companyEl.value||'').trim() || '‚Äî';
      const role = (roleEl.value||'').trim() || '‚Äî';
      const content = (textEl.value||'').trim();
      const question = (aiInputEl?.value||'').trim();
      return `Context: WorkVerify user draft
Company: ${company}
Role: ${role}
Text:
${content || '(no text yet)'}
---
Question:
${question || '(analyze tone, legality, red/green flags, suggestions)'}`;
    }
    function openChatWithContext(){
      const prefill = buildAIContext();
      // tryb ‚ÄûWorkVerify Chat‚Äù: tekst-only + notatki po stronie czatu
      const url = `chat.html?ctx=workverify&features=textonly,notes&prefill=${encodeURIComponent(prefill)}`;
      window.open(url, '_blank');
    }


       async function getSession(){
      const { data:{ session } } = await sb.auth.getSession();
      // cache last seen user id for per-user drafts
      _lastUserId = session?.user?.id || 'anon';
      return session || null;
    }


        async function setFormState(){
      const session = await getSession();
      const authed = !!session?.user;
      const fields = [companyEl, roleEl, textEl];

      if(!authed){
        fields.forEach(el=> el.disabled = true);
        if (submitBtn){
          submitBtn.textContent = 'Login to submit';
          submitBtn.onclick = () => location.href = 'profile.html';
        }
      }else{
        fields.forEach(el=> el.disabled = false);
        if (submitBtn){
          submitBtn.textContent = 'Publish';
          submitBtn.onclick = () => submitExperience();
        }
      }

      // Draft buttons are always usable (local only)
      if(saveDraftBtn) saveDraftBtn.disabled = false;
      if(loadDraftBtn) loadDraftBtn.disabled = false;
      if(clearDraftBtn) clearDraftBtn.disabled = false;
    }


    async function loadRecent(){
      if(!recentList) return;
      recentList.innerHTML = '<span class="muted">Loading‚Ä¶</span>';

      const { data, error } = await sb
        .from('work_experiences')
        .select('id, company, role, content, created_at, status')
        .eq('status','approved')
        .order('created_at', { ascending:false })
        .limit(6);

      if(error){
        recentList.innerHTML = `<span class="muted">Failed to load (${escapeHTML(error.message)})</span>`;
        return;
      }
      if(!data || !data.length){
        recentList.innerHTML = `<span class="muted">No approved entries yet.</span>`;
        return;
      }

      recentList.innerHTML = data.map(r=>{
        const meta = [
          r.company ? escapeHTML(r.company) : '‚Äî',
          r.role ? escapeHTML(r.role) : '‚Äî',
          new Date(r.created_at).toLocaleString()
        ].join(' ‚Ä¢ ');
        const content = escapeHTML(r.content.length > 260 ? r.content.slice(0,260)+'‚Ä¶' : r.content);
        return `<article class="recent-card">
                  <div class="recent-meta">${meta}</div>
                  <p class="recent-content">${content}</p>
                </article>`;
      }).join('');
    }

        // Implementacja wysy≈Çki ‚Äì wo≈Çana przez wrapper w <head>
    window._submitExperienceImpl = async function(){
      // auto-save current form into draft before publishing
      writeDraft({
        company: (companyEl.value||'').trim(),
        role: (roleEl.value||'').trim(),
        content: (textEl.value||'').trim()
      });

      const session = await getSession();
      if(!session){ alert('Please log in first.'); return; }

      const company = (companyEl.value||'').trim();
      const role = (roleEl.value||'').trim();
      const content = (textEl.value||'').trim();

      if(content.length < 40){
        alert('Please provide at least ~40 characters describing the situation.');
        return;
      }
      if (submitBtn){ submitBtn.disabled = true; submitBtn.textContent = 'Saving‚Ä¶'; }

      const payload = {
        author: session.user.id,
        company: company || null,
        role: role || null,
        content
        // status = 'pending' (domy≈õlnie po stronie SQL)
      };

      const { error } = await sb.from('work_experiences').insert(payload);
      if (submitBtn){ submitBtn.disabled = false; submitBtn.textContent = 'Publish'; }

      if(error){
        alert('Save failed: ' + error.message);
        return;
      }

      companyEl.value = ''; roleEl.value = ''; textEl.value = '';
      alert('Thanks! Your experience was submitted and is pending moderation.');
      loadRecent();
    };

        // Init
    document.addEventListener('DOMContentLoaded', async ()=>{
      await setFormState();
      await loadRecent();

      // Wire draft buttons
      if(saveDraftBtn) saveDraftBtn.onclick = saveDraftFromForm;
      if(loadDraftBtn) loadDraftBtn.onclick = loadDraftIntoForm;
      if(clearDraftBtn) clearDraftBtn.onclick = ()=>{
        companyEl.value=''; roleEl.value=''; textEl.value='';
      };

      // AI buttons
      if(aiUseDraftBtn) aiUseDraftBtn.onclick = ()=>{ aiInputEl.value = (textEl.value||'').trim(); };
      if(aiOpenChatBtn) aiOpenChatBtn.onclick = openChatWithContext;

      // Simple autosave on input (debounced)
      let t=null;
      [companyEl, roleEl, textEl].forEach(el=>{
        el.addEventListener('input', ()=>{
          clearTimeout(t);
          t = setTimeout(()=> writeDraft({
            company:(companyEl.value||'').trim(),
            role:(roleEl.value||'').trim(),
            content:(textEl.value||'').trim()
          }), 800);
        });
      });

      sb.auth.onAuthStateChange(async ()=>{
        await setFormState();
      });
    });

  </script>
</body>
</html>
