<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <meta name="robots" content="noindex, nofollow"/>
  <title>Mitobuster – BeAwarely</title>
  <link rel="stylesheet" href="css/style.css"/>

  <style>
    :root{
      --blue1:#007bff;
      --blue2:#66b2ff;
      --blue3:#b3d9ff;
      --safe-top: env(safe-area-inset-top, 0px);
    }

    body{
      margin:0;
      font-family:'Segoe UI', system-ui, Arial, sans-serif;
      background: rgba(0,0,0,.85);
      color:#fff;
      transition: background-color .3s, color .3s;
    }
    body.light-mode{ background: rgba(255,255,255,.9); color:#000; }

    /* --- Fixed Topbar (spójny z index.html) --- */
    #topbar{
      position: fixed;
      top: calc(14px + var(--safe-top));
      left: 20px; right: 20px;
      z-index: 10000;
      display:flex; justify-content:space-between; align-items:center;
      pointer-events:none;
    }
    #topbar .topbar-left, #topbar .topbar-right{
      display:flex; gap:12px; align-items:center; pointer-events:auto;
    }
    .pill{
      background-color: rgba(255,255,255,0.10);
      color: inherit;
      font-weight: 700;
      text-decoration: none;
      padding: 6px 14px; border-radius: 12px;
      transition: background-color .25s, transform .2s;
      display:inline-flex; align-items:center; gap:8px; border:none; cursor:pointer;
    }
    .pill:hover{ background-color: rgba(255,255,255,0.20); transform: translateY(-1px); }
    #modeIcon{
      font-size:1.1rem; line-height:1; width:auto; height:auto;
      border-radius:50%; padding:8px;
      background-color: rgba(255,255,255,0.10);
    }
    #loginBtn{ border-radius:12px; }

    @media (max-width:560px){
      #topbar{ top:10px; left:12px; right:12px; }
      #topbar .topbar-left, #topbar .topbar-right{ gap:8px; }
      #loginBtn{ padding:4px 10px; font-size:.9rem; }
      #modeIcon{ padding:6px; }
    }

    header{
      text-align:center;
      padding: calc(120px + var(--safe-top)) 16px 24px;
    }
    header h1{
      font-family:'Sriracha', cursive;
      font-size:56px; margin:0 0 6px; color:#fff;
    }
    body.light-mode header h1{ color:#000; }
    header p.sub{ opacity:.8; margin:0; }

    main{ max-width:1200px; margin: 0 auto; padding: 24px 16px 60px; }

    /* Filtry/Search (opcjonalne) */
    .controls{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      flex-wrap:wrap; margin: 10px 0 16px;
    }
    .controls input[type="search"]{
      flex:1 1 260px; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.15);
      background: rgba(255,255,255,.06); color:inherit; outline:none;
    }
    body.light-mode .controls input[type="search"]{ background: rgba(0,0,0,.05); border-color: rgba(0,0,0,.12); }

    /* Siatka mitów */
    .myths-grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(240px,1fr));
      gap:16px;
      align-items:stretch;
    }
    @media (max-width:1023px){ .myths-grid{ grid-template-columns: repeat(2, minmax(220px,1fr)); } }
    @media (max-width:639px){ .myths-grid{ grid-template-columns: 1fr; } }

    .myth-card{
      position:relative;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:16px;
      display:flex; flex-direction:column; gap:10px;
      transition: transform .15s ease, box-shadow .15s ease, border-color .2s;
    }
    .myth-card:hover{
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      border-color: rgba(255,255,255,.18);
    }
    body.light-mode .myth-card{ background: rgba(0,0,0,.04); border-color: rgba(0,0,0,.10); }

    .card-top{ display:flex; align-items:center; justify-content:space-between; }
    .icon{ font-size:22px; }
    .badge{
      font-size:12px; padding:4px 8px; border-radius:999px;
      background: rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.18);
    }
    .title{ font-size:18px; font-weight:800; line-height:1.2; margin: 0; }
    .meta{ font-size:12px; opacity:.8; }

    .details{ display:none; font-size:14px; opacity:.95; }
    .myth-card.open .details{ display:block; }

    .cta-row{ margin-top:auto; display:flex; justify-content:flex-end; gap:8px; }
    .btn{
      border:none; padding:9px 12px; border-radius:10px;
      background: linear-gradient(135deg, var(--blue1), var(--blue2));
      color:#fff; font-weight:700; cursor:pointer;
    }
        .btn.secondary{
      background: transparent; color: inherit; border:1px solid rgba(255,255,255,.18);
    }

    /* Verify box */
    .verify{ margin: 10px 0 22px; }
    .verify-box{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:12px;
      display:flex; flex-direction:column; gap:10px;
    }
    body.light-mode .verify-box{ background: rgba(0,0,0,.04); border-color: rgba(0,0,0,.10); }
    .verify-box textarea{
      width:100%; resize:vertical; min-height:84px;
      background: transparent; color: inherit;
      border:1px solid rgba(255,255,255,.18);
      border-radius:10px; padding:10px 12px; outline:none;
    }
    body.light-mode .verify-box textarea{ border-color: rgba(0,0,0,.18); }
    .verify-actions{ display:flex; justify-content:flex-end; }

    .verify-result{
      margin-top:10px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.12);
      border-radius:12px; padding:12px;
    }
    body.light-mode .verify-result{ background: rgba(255,255,255,.65); }
    .vr-line{ margin:6px 0; }
    .vr-label{ opacity:.85; font-weight:700; margin-right:6px; }


    /* Fokusy dla dostępności */
    .pill:focus-visible, .btn:focus-visible, a:focus-visible{
      outline: 2px solid var(--blue2); outline-offset:2px;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://xzwpqyomqjzmiqsszwkg.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh6d3BxeW9tcWp6bWlxc3N6d2tnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0MjIxMTYsImV4cCI6MjA2OTk5ODExNn0.QbjDO1xifFkDuIAZZ9WHfGomgxwhanP9BQtgMrFqDgg";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession:true, autoRefreshToken:true, detectSessionInUrl:true, storage: window.localStorage }
    });

    // Motyw
    document.addEventListener('DOMContentLoaded', ()=>{
      const isLight = (localStorage.getItem('mode') || 'dark') === 'light';
      document.body.classList.toggle('light-mode', isLight);
      document.body.classList.toggle('dark-mode', !isLight);
      const icon = document.getElementById('modeIcon');
      if (icon) icon.textContent = isLight ? '🌞' : '🌛';
    });
    function toggleLightDarkMode(){
      const isLight = document.body.classList.toggle('light-mode');
      document.body.classList.toggle('dark-mode', !isLight);
      localStorage.setItem('mode', isLight ? 'light' : 'dark');
      const icon = document.getElementById('modeIcon');
      if (icon) icon.textContent = isLight ? '🌞' : '🌛';
    }

    // Auth UI
    async function signInWithGoogle(){
      const { data, error } = await supabaseClient.auth.signInWithOAuth({
        provider: "google",
        options: { redirectTo: "https://beawarely.github.io/beawarely-demo/mitobuster.html" }
      });
      if (error) console.error(error);
      else if (data?.url) location.replace(data.url);
    }
    async function logoutUser(){
      try{ await supabaseClient.auth.signOut(); }catch(e){ console.warn(e); }
      location.replace('mitobuster.html');
    }
    function wireLoginUI(session){
      const logged = !!session;
      const btn = document.getElementById('loginBtn');
      const profileBtn = document.getElementById('yourProfileBtn');
      if (btn){
        btn.textContent = logged ? 'Log out' : 'Log In';
        btn.onclick = logged ? logoutUser : signInWithGoogle;
      }
      if (profileBtn) profileBtn.style.display = logged ? 'inline-flex' : 'none';
    }
    document.addEventListener('DOMContentLoaded', async ()=>{
      const { data: { session } } = await supabaseClient.auth.getSession();
      wireLoginUI(session);
    });
    supabaseClient.auth.onAuthStateChange((_ev, session)=> wireLoginUI(session));

    // Mitobuster – lokalne dane przykładowe (bez DB)
    const myths = [
  {
    id:1,
    title:"AI always tells the truth because it operates on facts.",
    verdict:"Busted",
    reality:"Language models generate statistically likely answers and can hallucinate. Always ask for sources and verify.",
    tags:["AI","Hallucinations"]
  },
  {
    id:2,
    title:"Incognito mode completely hides me on the internet.",
    verdict:"Busted",
    reality:"Incognito clears local history. Your ISP and websites can still identify you. You need a broader privacy model.",
    tags:["Privacy","Browser"]
  },
  {
    id:3,
    title:"More megapixels always means better photos.",
    verdict:"Plausible",
    reality:"Quality also depends on sensor size, optics, and processing. MP is only one factor.",
    tags:["Photography","Hardware"]
  },
  {
    id:4,
    title:"Charging overnight ruins the battery.",
    verdict:"Needs Sources",
    reality:"Modern devices manage charging. Degradation comes mainly from cycles, temperature, and time — not nighttime alone.",
    tags:["Battery","Smartphone"]
  },
  {
    id:5,
    title:"VPN equals full anonymity.",
    verdict:"Busted",
    reality:"A VPN hides traffic from your network operator, but it doesn't make you anonymous to websites or the VPN provider.",
    tags:["VPN","Privacy"]
  },
  {
    id:6,
    title:"AI will take all jobs within 5 years.",
    verdict:"Debated",
    reality:"AI automates tasks, creates new roles, and reshapes skills. Scale and timing are uncertain.",
    tags:["Workforce","AI"]
  }
];

    function renderMyths(list){
      const grid = document.getElementById('mythsGrid');
      grid.innerHTML = '';
      for (const m of list){
        const art = document.createElement('article');
        art.className = 'myth-card';
        art.innerHTML = `
          <div class="card-top">
            <span class="icon">🧯</span>
            <span class="badge">${m.verdict}</span>
          </div>
          <h3 class="title">${m.title}</h3>
          <div class="meta">${(m.tags||[]).join(' • ')}</div>
          <div class="details">
            <strong>Reality:</strong> ${m.reality}
          </div>
          <div class="cta-row">
            <button class="btn secondary" type="button">Details</button>
            <a class="btn" href="#" onclick="return false;">Share</a>
          </div>
        `;
        const detailsBtn = art.querySelector('.btn.secondary');
        detailsBtn.addEventListener('click', ()=>{
          art.classList.toggle('open');
          detailsBtn.textContent = art.classList.contains('open') ? 'Hide' : 'Details';
        });
        grid.appendChild(art);
      }
    }

        document.addEventListener('DOMContentLoaded', ()=>{
      const search = document.getElementById('mythSearch');
      renderMyths(myths);

      if (search){
        search.addEventListener('input', ()=>{
          const q = search.value.toLowerCase().trim();
          if (!q) return renderMyths(myths);
          const filtered = myths.filter(m =>
            m.title.toLowerCase().includes(q) ||
            (m.tags||[]).some(t=> t.toLowerCase().includes(q)) ||
            m.verdict.toLowerCase().includes(q)
          );
          renderMyths(filtered);
        });
      }

      // Wire verify
      const verifyBtn = document.getElementById('verifyBtn');
      const mythInput = document.getElementById('mythInput');
      if (verifyBtn && mythInput){
        verifyBtn.addEventListener('click', async ()=>{
          const text = (mythInput.value || '').trim();
          if (!text){ mythInput.focus(); return; }
          verifyBtn.disabled = true; verifyBtn.textContent = 'Checking…';
          try{
            const result = await verifyMyth(text);
            showVerifyResult(result);
          }catch(e){
            showVerifyResult({ verdict:'Error', reasoning:'Failed to verify. Please try again later.' });
          }finally{
            verifyBtn.disabled = false; verifyBtn.textContent = 'Check with AI →';
          }
        });
      }
    });

    // Try Supabase Edge Function first (optional), else fallback heuristic
    async function verifyMyth(text){
      const EDGE_URL = 'https://xzwpqyomqjzmiqsszwkg.functions.supabase.co/verify-myth';
      try{
        const { data: { session } } = await supabaseClient.auth.getSession();
        const r = await fetch(EDGE_URL, {
          method:'POST',
          headers:{
            'Content-Type':'application/json',
            'Authorization': 'Bearer ' + (session?.access_token || SUPABASE_ANON_KEY)
          },
          body: JSON.stringify({ myth:text })
        });
        if (r.ok){
          const json = await r.json();
          return {
            verdict: json.verdict || 'Needs Sources',
            reasoning: json.reasoning || 'No reasoning returned.',
            sources: json.sources || []
          };
        }
      }catch(e){ /* ignore and fallback */ }
      return verifyMythClient(text);
    }

    // Simple client heuristic fallback
    function verifyMythClient(text){
      const t = text.toLowerCase();
      let verdict = 'Needs Sources';
      if (/\b(always|never|guaranteed|100%)\b/.test(t)) verdict = 'Busted';
      if (/\bmaybe|could|might|depends\b/.test(t)) verdict = 'Plausible';
      if (/\bconspiracy|flat earth|chemtrails\b/.test(t)) verdict = 'Busted';
      if (/\bai\b/.test(t) && /\btruth|facts\b/.test(t)) verdict = 'Debated';
      const reasoning = 'Preliminary, heuristic assessment. Connect an AI verifier (Edge Function) for authoritative results.';
      return { verdict, reasoning, sources: [] };
    }

    function showVerifyResult({ verdict, reasoning, sources }){
      const box = document.getElementById('verifyResult');
      const v = document.getElementById('vrVerdict');
      const r = document.getElementById('vrReason');
      const sw = document.getElementById('vrSourcesWrap');
      const s = document.getElementById('vrSources');
      if (!box || !v || !r) return;
      v.textContent = verdict || '—';
      r.textContent = reasoning || '—';
      if (sources && sources.length){
        sw.hidden = false;
        s.textContent = sources.join(' • ');
      }else{
        sw.hidden = true;
      }
      box.hidden = false;
      box.scrollIntoView({ behavior:'smooth', block:'nearest' });
    }

  </script>
</head>
<body>

  <!-- TOPBAR -->
  <div id="topbar">
    <div class="topbar-left">
      <a href="index.html" class="pill">← Back</a>
      <a id="yourProfileBtn" href="profile.html" class="pill" style="display:none">Your Profile</a>
    </div>
    <div class="topbar-right">
      <button id="modeIcon" type="button" class="pill" aria-label="Toggle light/dark mode" onclick="toggleLightDarkMode()">🌛</button>
      <button id="loginBtn" type="button" class="pill">Log In</button>
    </div>
  </div>

  <header>
    <h1>Mitobuster</h1>
    <p class="sub">Busting myths. Short, clear, verified.</p>
  </header>

    <main>
    <div class="controls">
      <input id="mythSearch" type="search" placeholder="Search a myth, tag, or verdict..."/>
    </div>

    <!-- Verify a myth (user input) -->
    <section class="verify">
      <h2 style="margin:6px 0 8px;">Verify a myth</h2>
      <div class="verify-box">
        <textarea id="mythInput" rows="3" placeholder="Paste a myth you've heard..."></textarea>
        <div class="verify-actions">
          <button id="verifyBtn" class="btn" type="button">Check with AI →</button>
        </div>
      </div>

      <div id="verifyResult" class="verify-result" hidden>
        <div class="vr-line"><span class="vr-label">Verdict:</span> <span id="vrVerdict">—</span></div>
        <div class="vr-line"><span class="vr-label">Reasoning:</span> <span id="vrReason">—</span></div>
        <div class="vr-line" id="vrSourcesWrap" hidden><span class="vr-label">Sources:</span> <span id="vrSources">—</span></div>
      </div>
    </section>

    <section>
      <div id="mythsGrid" class="myths-grid"></div>
    </section>
  </main>

</body>
</html>
